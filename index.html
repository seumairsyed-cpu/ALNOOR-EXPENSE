<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ALNOOR GARDEN HOME EXPENSE</title>

<style>
body{
    margin:0;
    font-family:Segoe UI, sans-serif;
    background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    color:white;
}

.container{
    width:95%;
    margin:auto;
    padding:20px;
}

header{
    text-align:center;
    font-size:28px;
    font-weight:bold;
    letter-spacing:2px;
    margin-bottom:10px;
}

#clock{
    position:absolute;
    top:20px;
    right:30px;
    text-align:right;
    font-size:14px;
}

.filters{
    display:flex;
    justify-content:center;
    gap:15px;
    flex-wrap:wrap;
    margin:20px 0;
}

.filters input, .filters select{
    padding:8px 12px;
    border-radius:6px;
    border:none;
    font-weight:bold;
}

.kpi{
    text-align:center;
    font-size:32px;
    font-weight:bold;
    margin:20px 0;
    padding:15px;
    border-radius:10px;
    background:linear-gradient(90deg,#00c6ff,#0072ff);
}

table{
    width:100%;
    border-collapse:collapse;
    background:white;
    color:black;
    border-radius:10px;
    overflow:hidden;
}

th, td{
    padding:10px;
    text-align:left;
}

th{
    background:#0072ff;
    color:white;
}

tr:nth-child(even){
    background:#f2f2f2;
}

.buttons{
    text-align:center;
    margin:25px 0;
}

button{
    padding:10px 20px;
    margin:10px;
    border:none;
    border-radius:6px;
    font-weight:bold;
    cursor:pointer;
    background:linear-gradient(90deg,#ff512f,#dd2476);
    color:white;
}

button:hover{
    opacity:0.9;
}

#loginScreen{
    position:fixed;
    width:100%;
    height:100%;
    background:linear-gradient(135deg,#141e30,#243b55);
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
}

#loginScreen input{
    padding:10px;
    margin:10px;
    border-radius:6px;
    border:none;
}
</style>
</head>

<body>

<div id="loginScreen">
    <h2>Enter Password</h2>
    <input type="password" id="passwordInput">
    <button onclick="checkPassword()">Login</button>
</div>

<div class="container" id="dashboard" style="display:none;">

<div id="clock"></div>

<header>ALNOOR GARDEN HOME EXPENSE</header>

<div class="filters">
    <input type="date" id="fromDate">
    <input type="date" id="toDate">

    <select id="headFilter">
        <option value="">All Heads</option>
        <option>ELECTRICITY BILL</option>
        <option>SUI GAS BILL</option>
        <option>WATER BILL</option>
        <option>STORM FIBER</option>
        <option>SECURITY BILL</option>
        <option>GROCERY</option>
        <option>PLUMBING</option>
        <option>ELECTRIC WORK</option>
        <option>CAR RELATED</option>
        <option>MISC. HOUSEHOLD</option>
        <option>MISC. EXPENSE</option>
    </select>

    <select id="modeFilter">
        <option value="">All Modes</option>
        <option>CASH</option>
        <option>ONLINE</option>
        <option>DEBIT CARD</option>
    </select>
</div>

<div class="kpi">
    TOTAL EXPENSE: Rs <span id="totalExpense">0</span>
</div>

<table>
<thead>
<tr>
<th>HEAD</th>
<th>DESCRIPTION</th>
<th>AMOUNT</th>
<th>MODE</th>
<th>DATE</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<div class="buttons">
    <button onclick="window.open('https://forms.gle/RHvNmsEchqCM1QK48','_blank')">
        Enter Expense Now
    </button>
    <button onclick="fetchData()">Refresh Data</button>
    <button onclick="changePassword()">Change Password</button>
</div>

</div>

<script>
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQuAsH1_3C4iz6LZFf4rBcPqI19su_PdhQiyEYd7HlAtkLOAUEliHkrGdsGg6Mj0RewWsgHZ4knskaJ/pub?gid=1464536103&single=true&output=csv";

let sheetData = [];
let password = localStorage.getItem("dashboardPassword") || "1234";

function checkPassword(){
    const input = document.getElementById("passwordInput").value;
    if(input === password){
        document.getElementById("loginScreen").style.display="none";
        document.getElementById("dashboard").style.display="block";
        fetchData();
    } else {
        alert("Incorrect Password");
    }
}

function changePassword(){
    const newPass = prompt("Enter New Password:");
    if(newPass){
        password = newPass;
        localStorage.setItem("dashboardPassword", newPass);
        alert("Password Changed Successfully");
    }
}

function fetchData(){
    fetch(sheetURL)
    .then(res=>res.text())
    .then(csv=>{
        const rows = csv.split("\n").slice(1);
        sheetData = rows.map(r=>{
            const cols = r.split(",");
            return {
                head: cols[1],
                description: cols[2],
                amount: parseFloat(cols[3]) || 0,
                mode: cols[4],
                date: cols[5]
            }
        });
        applyFilters();
    });
}

function applyFilters(){
    const from = document.getElementById("fromDate").value;
    const to = document.getElementById("toDate").value;
    const head = document.getElementById("headFilter").value;
    const mode = document.getElementById("modeFilter").value;

    let filtered = sheetData.filter(item=>{
        let valid=true;
        if(from && new Date(item.date)<new Date(from)) valid=false;
        if(to && new Date(item.date)>new Date(to)) valid=false;
        if(head && item.head!==head) valid=false;
        if(mode && item.mode!==mode) valid=false;
        return valid;
    });

    let total = 0;
    const tbody=document.getElementById("tableBody");
    tbody.innerHTML="";

    filtered.forEach(item=>{
        total+=item.amount;
        tbody.innerHTML+=`
        <tr>
            <td>${item.head}</td>
            <td>${item.description}</td>
            <td>${item.amount}</td>
            <td>${item.mode}</td>
            <td>${item.date}</td>
        </tr>`;
    });

    document.getElementById("totalExpense").innerText=total.toLocaleString();
}

document.querySelectorAll("#fromDate,#toDate,#headFilter,#modeFilter")
.forEach(el=>el.addEventListener("change",applyFilters));

function updateClock(){
    const now=new Date();
    const days=["SUN","MON","TUE","WED","THU","FRI","SAT"];
    document.getElementById("clock").innerHTML=
        now.toLocaleTimeString()+"<br>"+
        now.toLocaleDateString("en-GB")+" "+days[now.getDay()];
}
setInterval(updateClock,1000);
updateClock();
</script>

</body>
</html>
