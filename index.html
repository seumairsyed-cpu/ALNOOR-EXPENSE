<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ALNOOR GARDEN HOME EXPESE</title>

<style>
/* ========== GLOBAL STYLING ========== */
body{
    margin:0;
    font-family: 'Segoe UI', Tahoma, sans-serif;
    color:#222;
    background: linear-gradient(-45deg,#e3f2fd,#fce4ec,#e8f5e9,#fff3e0);
    background-size: 400% 400%;
    animation: gradientMove 12s ease infinite;
}

@keyframes gradientMove{
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
}

header{
    background:#ffffffcc;
    backdrop-filter: blur(6px);
    padding:20px;
    text-align:center;
    font-size:26px;
    font-weight:700;
    letter-spacing:1px;
    position:relative;
    box-shadow:0 3px 10px rgba(0,0,0,0.08);
}

#clock{
    position:absolute;
    right:30px;
    top:22px;
    font-size:15px;
    font-weight:600;
    text-align:right;
}

/* ========== FILTER SECTION ========== */
.filters{
    display:flex;
    justify-content:center;
    align-items:center;
    gap:20px;
    padding:25px;
    flex-wrap:wrap;
}

.filters input,
.filters select{
    padding:8px 12px;
    border-radius:6px;
    border:1px solid #bbb;
    font-size:14px;
    min-width:150px;
}

/* ========== KPI CARD ========== */
.kpi{
    text-align:center;
    font-size:22px;
    font-weight:700;
    margin:10px auto 25px auto;
    padding:15px 30px;
    width:fit-content;
    background:white;
    border-radius:10px;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
}

/* ========== TABLE ========== */
.table-container{
    width:92%;
    margin:auto;
    background:white;
    border-radius:10px;
    box-shadow:0 4px 15px rgba(0,0,0,0.08);
    padding:15px;
    max-height:400px;
    overflow-y:auto;
}

table{
    width:100%;
    border-collapse:collapse;
}

th{
    background:#1976d2;
    color:white;
    padding:10px;
    font-size:14px;
}

td{
    padding:8px;
    border-bottom:1px solid #eee;
    font-size:13px;
}

tr:hover{
    background:#f1f7ff;
}

/* ========== BUTTONS ========== */
.buttons{
    text-align:center;
    margin:30px 0;
}

button{
    padding:10px 22px;
    font-size:14px;
    border:none;
    border-radius:6px;
    margin:0 10px;
    cursor:pointer;
    background:#1976d2;
    color:white;
    transition:0.3s;
}

button:hover{
    background:#0d47a1;
}
</style>
</head>

<body>

<header>
    ALNOOR GARDEN HOME EXPESE
    <div id="clock"></div>
</header>

<div class="filters">
    <input type="date" id="fromDate">
    <input type="date" id="toDate">

    <select id="headFilter">
        <option value="">All Heads</option>
        <option>ELECTRICITY BILL</option>
        <option>SUI GAS BILL</option>
        <option>WATER BILL</option>
        <option>STORM FIBER</option>
        <option>SECURITY BILL</option>
        <option>GROCERY</option>
        <option>PLUMBING</option>
        <option>ELECTRIC WORK</option>
        <option>CAR RELATED</option>
        <option>MISC. HOUSEHOLD</option>
        <option>MISC. EXPENSE</option>
    </select>

    <select id="modeFilter">
        <option value="">All Modes</option>
        <option>CASH</option>
        <option>ONLINE</option>
        <option>DEBIT CARD</option>
    </select>
</div>

<div class="kpi" id="totalKPI">
    Total Expense: 0
</div>

<div class="table-container">
<table>
    <thead>
        <tr>
            <th>Date</th>
            <th>Head</th>
            <th>Description</th>
            <th>Amount</th>
            <th>Mode</th>
        </tr>
    </thead>
    <tbody id="expenseBody"></tbody>
</table>
</div>

<div class="buttons">
    <button onclick="window.open('https://forms.gle/RHvNmsEchqCM1QK48','_blank')">
        Enter Expense Now
    </button>
    <button onclick="fetchData()">Refresh Data</button>
</div>

<script>

// ================= CLOCK =================
function updateClock(){
    const now = new Date();
    const options = { weekday:'short', day:'2-digit', month:'2-digit', year:'numeric' };
    const dateStr = now.toLocaleDateString('en-GB', options);
    const timeStr = now.toLocaleTimeString('en-GB',{hour12:false});
    document.getElementById("clock").innerHTML = `${timeStr}<br>${dateStr}`;
}
setInterval(updateClock,1000);
updateClock();

// ================= DATA =================
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQuAsH1_3C4iz6LZFf4rBcPqI19su_PdhQiyEYd7HlAtkLOAUEliHkrGdsGg6Mj0RewWsgHZ4knskaJ/pub?gid=1464536103&single=true&output=csv";

let allData = [];

async function fetchData(){
    const response = await fetch(sheetURL);
    const csv = await response.text();
    parseCSV(csv);
    filterData();
}

function parseCSV(csv){
    const rows = csv.split("\n").slice(1);
    allData = rows.map(r=>{
        const cols = r.split(",");
        return {
            head: cols[1]?.trim(),
            desc: cols[2]?.trim(),
            amount: parseFloat(cols[3]) || 0,
            mode: cols[4]?.trim(),
            date: new Date(cols[5])
        };
    }).filter(r=>r.date instanceof Date && !isNaN(r.date));
}

function filterData(){
    const from = document.getElementById("fromDate").valueAsDate;
    const to = document.getElementById("toDate").valueAsDate;
    const head = document.getElementById("headFilter").value;
    const mode = document.getElementById("modeFilter").value;

    let filtered = allData.filter(r=>{
        if(from && r.date < from) return false;
        if(to && r.date > to) return false;
        if(head && r.head !== head) return false;
        if(mode && r.mode !== mode) return false;
        return true;
    });

    // KPI
    const total = filtered.reduce((sum,r)=>sum+r.amount,0);
    document.getElementById("totalKPI").innerText = 
        "Total Expense: " + total.toLocaleString();

    // Table
    const tbody = document.getElementById("expenseBody");
    tbody.innerHTML="";
    filtered.sort((a,b)=>b.date-a.date);
    filtered.forEach(r=>{
        tbody.innerHTML += `
            <tr>
                <td>${r.date.toLocaleDateString('en-GB')}</td>
                <td>${r.head}</td>
                <td>${r.desc}</td>
                <td>${r.amount.toLocaleString()}</td>
                <td>${r.mode}</td>
            </tr>
        `;
    });
}

// Auto refresh on filter change
["fromDate","toDate","headFilter","modeFilter"]
.forEach(id=>{
    document.getElementById(id).addEventListener("change",filterData);
});

fetchData();

</script>

</body>
</html>
